{% extends "user/base.html" %}
{% load crispy_forms_tags %}
{% block content %}
	<article class="media content-section">
		<img class="rounded-circle article-img" src="{{ pin.image.url }}">
		<div class="media-body">
			<div class="article-metadata">
			  <h2>{{ pin.title }}</h2>
			  <small class="text-muted">{{ pin.date_posted|date:"F d, Y" }}</small>
			</div>
			{% if pin.author == user %}
		      	<div>
			      	<a class = 'btn btn-secondary btn-sm mt-1 mb-1' href="{% url 'pin-update' pin.pk %}">Update</a>
			      	<a class = 'btn btn-danger btn-sm mt-1 mb-1' href="{% url 'pin-delete' pin.pk %}">Delete</a>
			    </div>
			{% endif %}
			<h2 class="article-title">{{ pin.name }}</h2>
			<div class="article-metadata">
				{% if user.is_authenticated %}
					<p>
						<div>
							<button><a class="like-button" href="{% url 'like-toggle' pin.pk %}">Like</a></button> {{ pin.likes.count }}
						</div>
						<br>
						<div>
							Comments: {{ comments.count }} comment{{ comments|pluralize }}</p>
						</div>
				{% else %}
					<p>
						<div>
							Likes: {{ pin.likes.count }} <br>
							Comments: {{ comments.count }} 
						</div>
					</p>		
						
				{% endif %}
			</div>
			
			<div class="main-comment-section">
				{% if request.user.is_authenticated %}				
				<h2>Comments</h2>
				{% for comment in comments %}
				<blockquote class="blockquote">
					<div class="comment">
						<p class="mb-0">{{ comment.content }}
						{% if request.user == comment.user %}
							<a class = 'btn btn-secondary btn-sm mt-1 mb-1' href="{% url 'comment-delete' comment.pk %}">Delete</a>
						{% endif %}
						</p>
						<footer class="blockquote-footer">by <cite title="Source Title">{{ comment.user }}</cite></footer>
					</div>
				</blockquote>
				{% endfor %}
				{% endif %}
			</div>
			<br>
			<br>
			{% if request.user.is_authenticated %}
			<form method="post">
				{% csrf_token %}
				{{ comment_form|crispy }}
				<input type="submit" value="Submit" class="btn btn-outline-success">
			</form>
			{% endif %}
		</div>
	</article>
{% endblock content%}